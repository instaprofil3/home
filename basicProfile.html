<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div
        style="text-align: center; border: 2px solid white; width: 60em; height: 50em; margin: auto; font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;">
        <h1 style="color:pink;" class="welcome">Basic Profile</h1>

        <input style="text-align: center; border: 2px solid rgb(97, 204, 240)" onkeypress="keyPressed(event, this)"
            placeholder="Instagram Username">

        <button style="text-align: center; border: 2px solid rgb(97, 204, 240)" onclick="loadData()">Load Previous
            Data</button>
    </div>

    <script>
        // img src, 1st p text, 2nd p text
        function saveData(src, text1, text2) {
            let data = [src, text1, text2];

            window.localStorage.setItem('basicProfileData', JSON.stringify(data));
        }

        function loadData() {
            if (localStorage.length > 1) {
                if (document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0] != undefined && 
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0].innerText == "Error, this account does not exist.") {
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0].remove();
                }

                let data = JSON.parse(localStorage.getItem('basicProfileData'));

                let elements = [document.createElement('img'),
                                document.createElement('p'),
                                document.createElement('p'),
                                document.createElement('div')];

                document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].appendChild(elements[elements.length - 1]);

                for (let i = 0; i < elements.length - 1; i++) {
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[1].appendChild(elements[i]);

                    switch (i) {
                        case 0:
                            elements[i].setAttribute("src", data[0]);
                            elements[i].setAttribute("style", "padding: 16px;");
                            break;
                        case 1:
                            elements[i].setAttribute('class', 'welcome');
                            elements[i].innerHTML = "<span style='color: pink;'>" + data[1] + "</span>";
                            break;
                        case 2:
                            elements[i].setAttribute('class', 'welcome');
                            if (data[2] != "This user doesn't have a Biography") {
                                elements[i].innerHTML = "Biography: " + "<span style='color: pink'>" + data[2].substring(11) + "</span>";
                            } else {
                                elements[i].innerHTML = "<span style='color: red;'>" + data[2] + "</span>"
                            }
                            break;
                    }
                }
            }
        }


        // Loads Profile
        function loadProfile(elem) {
            $.getJSON('https://www.instagram.com/' + elem.value + '/?__a=1', data => {
                if (document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0] != undefined && 
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0].innerText == "Error, this account does not exist.") {
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0].remove();
                }

                let elements = [document.createElement('img'),
                                document.createElement('p'),
                                document.createElement('p'),
                                document.createElement('div')];

                // img.setAttribute('src', data.graphql.user.profile_pic_url_hd);
                // img.setAttribute('alt', 'Profile Picture');
                // img.setAttribute('style', 'padding: 16px;');

                if (document.getElementsByTagName('main')[0].getElementsByTagName('img').length < 1) {
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].appendChild(elements[elements.length - 1]);

                    for (let i = 0; i < elements.length - 1; i++) {
                        document.getElementsByTagName('main')[0].getElementsByTagName('div')[1].appendChild(elements[i]);

                        switch (i) {
                            case 0:
                                elements[i].setAttribute("src", data.graphql.user.profile_pic_url_hd);
                                elements[i].setAttribute("style", "padding: 16px;");
                                break;
                            case 1:
                                elements[i].setAttribute('class', 'welcome');
                                elements[i].innerHTML = "<span style='color: pink; padding: 16px;'>" + data.graphql.user.full_name + "</span>";
                                break;
                            case 2:
                                elements[i].setAttribute('class', 'welcome');
                                if (data.graphql.user.biography != "") {
                                    elements[i].innerHTML = "Biography: <span style='color: pink'>" + data.graphql.user.biography + "</span>";
                                } else {
                                    elements[i].innerHTML = "<span style='color: red; padding: 16px;'>This user doesn't have a Biography</span>";
                                }
                                break;
                        }
                    }

                    saveData(elements[0].getAttribute('src'), elements[1].innerText, elements[2].innerText);

                } else {
                    let list = []
                    list.push(document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('img')[0],
                        document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0],
                        document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[1]);

                    list[0].setAttribute('src', data.graphql.user.profile_pic_url_hd);
                    list[1].innerText = data.graphql.user.full_name;

                    if (data.graphql.user.biography != "") {
                        list[2].innerHTML = "Biography:<span style='color: pink; padding: 16px;'>" + data.graphql.user.biography + "</span>";
                    } else {
                        list[2].innerHTML = "<span style='color: red; padding: 16px;'>This user doesn't have a Biography</span>";
                    }

                    saveData(list[0].getAttribute('src'), list[1].innerText, list[2].innerText);
                }

                elem.value = "";
            }).fail(() => {
                if (document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('img')[0] != undefined) {
                    let list = []
                    list.push(document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('img')[0],
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[0],
                    document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].getElementsByTagName('p')[1]);

                    for (let i = 0; i < list.length; i++) {
                        list[i].remove();
                    }
                }

                let p = document.createElement('p');

                p.innerHTML = "<span style='color: red;'>Error, this account does not exist.</span>";

                document.getElementsByTagName('main')[0].getElementsByTagName('div')[0].appendChild(p);

                elem.value = "";
            });

        }

        function keyPressed(event, elem) {
            if (event.keyCode == 13) {
                loadProfile(elem);
            }
        }
    </script>
</body>

</html>